trigger:
- main

pr:
- '*'
pool:
  vmImage: 'ubuntu-latest'

steps:
- task: Docker@2
  displayName: 'Build and push Docker image'
  inputs:
    command: 'buildAndPush'
    azureSubscriptionEndpoint: 'b644be36-9223-42a4-8a5d-a326f8e0af33'
    azureContainerRegistry: 'acrwayner.azurecr.io'
    dockerFile: '**/Dockerfile'
    imageName: 'acrwayner.azurecr.io/meu-nginx:$(Build.BuildId)'
    includeLatestTag: true
#variables:
#  dockerRegistryServiceConnection: '{"loginServer":"acrwayner.azurecr.io", "id" : "/subscriptions/b644be36-9223-42a4-8a5d-a326f8e0af33/resourceGroups/rg-testes-wayner/providers/Microsoft.ContainerRegistry/registries/acrwayner"}'
#  imageRepository: 'acrwayner'
#  azureContainerRegistry: 'acrwayner.azurecr.io'
#  dockerfilePath: '$(Build.SourcesDirectory)/WEB-APP-TESTES/Dockerfile'
#  tag: '$(Build.BuildId)'
#
#  vmImageName: 'ubuntu-latest'
#
#stages:
#  - stage: Build
#    displayName: 'Build and push stage'  
#    jobs:
#    - job: Build
#      displayName: Build
#      pool:
#        vmImage: $(vmImageName)  
#      steps:
#       
#      - task: Docker@2
#        displayName: Build and push an image to container registry
#        inputs:
#          command: buildAndPush
#          repository: $(imageRepository)
#          dockerfile: $(dockerfilePath)
#          containerRegistry: $(dockerRegistryServiceConnection)
#          tags: |
#            $(tag)
#            latest

#steps:
#- task: DockerCompose@0
#  displayName: 'Execute Docker Compose up'
#  inputs:
#    containerregistrytype: 'Azure Container Registry'
#    azureSubscription: 'Azure for Students(b644be36-9223-42a4-8a5d-a326f8e0af33)'
#    azureContainerRegistry: '{"loginServer":"acrwayner.azurecr.io", "id" : "/subscriptions/b644be36-9223-42a4-8a5d-a326f8e0af33/resourceGroups/rg-testes-wayner/providers/Microsoft.ContainerRegistry/registries/acrwayner"}'
#    dockerComposeFile: '**/docker-compose.yml'
#    action: 'Run a Docker Compose command'
#    dockerComposeCommand: 'up'